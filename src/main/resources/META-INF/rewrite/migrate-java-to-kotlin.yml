#
# Copyright 2025 the original author or authors.
# <p>
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
# <p>
# https://www.apache.org/licenses/LICENSE-2.0
# <p>
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
#

---
type: specs.openrewrite.org/v1beta/recipe
name: com.jevanlingen.MigrateJavaToKotlin
displayName: Migrate Java to Kotlin
description: Replaces Java files with Kotlin equivalent.
recipeList:
  - org.openrewrite.maven.AddPlugin:
      groupId: org.jetbrains.kotlin
      artifactId: kotlin-maven-plugin
      version: 1.9.25
      executions: |
        <executions>
            <execution>
                <id>compile</id>
                <phase>compile</phase>
                <goals>
                    <goal>compile</goal>
                </goals>
            </execution>
            <execution>
                <id>test-compile</id>
                <phase>test-compile</phase>
                <goals>
                    <goal>test-compile</goal>
                </goals>
            </execution>
        </executions>
  # TODO: Add <sourceDirectory>${project.basedir}/src/main/kotlin</sourceDirectory> and <testSourceDirectory>${project.basedir}/src/test/kotlin</testSourceDirectory> for maven
  - org.openrewrite.gradle.plugins.AddBuildPlugin:
      pluginId: org.jetbrains.kotlin.jvm
      version: 1.9.25
  # TODO: Add kotlin { jvmToolchain(21) } for Kotlin.    
  - org.openrewrite.java.dependencies.AddDependency:
      groupId: org.jetbrains.kotlin
      artifactId: kotlin-stdlib
      version: 1.9.25
  - org.openrewrite.java.dependencies.AddDependency:
      groupId: org.jetbrains.kotlin
      artifactId: kotlin-test
      version: 1.9.25
      scope: test
  - org.openrewrite.java.dependencies.AddDependency:
      groupId: org.jetbrains.kotlin
      artifactId: kotlin-test-junit5
      version: 1.9.25
      scope: test
  - org.openrewrite.staticanalysis.FinalizeLocalVariables
  # TODO: This recipe could be used to fix the nullable stuff, but:
  #  - that recipe is not complete, so we cannot dependent on it until it's 100% perfect (otherwise we will create nullable compile errors)
  #  - The `com.jevanlingen.TransformToKotlin` recipe needs to be improved to benefit from it
  #  - org.openrewrite.staticanalysis.AnnotateNullableMethods
  - com.jevanlingen.TransformToKotlin
  - org.openrewrite.kotlin.cleanup.RemoveLambdaArgumentParentheses
  - org.openrewrite.kotlin.cleanup.RemoveTrailingSemicolon
  - org.openrewrite.kotlin.cleanup.EqualsMethodUsage
